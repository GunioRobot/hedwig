{"content":"<h1>Capturing</h1>\n\n<p>There are many instances where you may have to capture touches. We'll consider scroll views,\nhowever, because it is very easy to explain <em>why</em> they need to be able to.</p>\n\n<p>If you are implementing a scroll view, you'll need to capture the touch before the target view gets it.</p>\n\n<p>This is because scroll views have some subtle quirks. For instance, a touch should not pass\nthrough to the actual target until a split-second has passed&emdash;this is to prevent flicker should\nthe user decide to scroll rather than touch the target. Also, it needs to add itself to what is\ncalled the \"touch responder stack\" <em>before</em> the target view, so that the target view can hand control back\nsimply as discussed above.</p>\n\n<h2>Touch Responder Stack</h2>\n\n<p>Very briefly mentioned in the \"Touch Events\" article, the <em>touch responder</em> is the view which\n\"owns\" a touch\u2014the view which gets all touchesDragged events and the touchEnd for that touch.</p>\n\n<p>However, in our scroll view case, we want to pass control to the target view, but allow it\nto <em>transfer control back</em> (a process covered in \"Releasing\"). That means it needs to know\nwhat view to hand it back to. Also, what if you had a scroll view <em>within</em> a scroll view?</p>\n\n<p>To solve these issues, there is a \"stack\" of those views to which control can be passed back to.</p>\n\n<p>You generally work with it by either:</p>\n\n<ul>\n<li>Specifically telling it to \"stack\" your view when capturing a touch.</li>\n<li>Telling it to change touch responder to a touch responder in the stack (see Releasing)</li>\n</ul>\n\n<h2>Capturing</h2>\n\n<p>Capturing the touch is simple. Before starting at the target view and working its\nway up to the root calling touchStart (the same way all SproutCore events work), \nSproutCore's touch events go the opposite direction, starting at the root and working their way down\nto the target, calling a method named captureTouch:</p>\n\n<pre><code class='syntax js'><span class=\"variable\">captureTouch</span>: <span class=\"keyword\">function</span>(<span class=\"variable\">touch</span>) {\n</code></pre>\n\n<p>If the view returns YES, the touchStart event will be sent directly to it.</p>\n\n<p>You could then use invokeLater to wait that split-second. But then what? You don't actually\nknow what the target view should be. What you need is to start at the original target, and\ndo the whole working up to it calling captureTouch and work down from it calling touchStart\nthing\u2014but this time, starting from your own view, rather than the root. </p>\n\n<p>Thankfully, you can do this in one line of code:</p>\n\n<pre><code class='syntax js'><span class=\"variable\">touch</span>.<span class=\"variable\">captureTouch</span>(<span class=\"this\">this</span>, <span class=\"class\">YES</span>); <span class=\"comment\">// the YES means stack, which I'm guessing you'd want to do</span>\n<span class=\"comment\">// so that the new view can easily pass control back to this...</span>\n<span class=\"comment\">// ... but you may know better than me.</span>\n</code></pre>\n\n<p>What happens next depends on whether or not you told it to stack your view:</p>\n\n<ul>\n<li>If stacked, you will receive a touchCancelled when the touch actually ends, unless the\nview which captures the touch hands control back to your view. If it does, you will <em>not</em>\nreceive another <code class='syntax js'><span class=\"variable\">touchStart</span></code>, but you <em>will</em> start receiving <code class='syntax js'><span class=\"variable\">touchesDragged</span></code> and \nwill receive a <code class='syntax js'><span class=\"variable\">touchEnd</span></code> when the touch ends.</li>\n<li>If not stacked, your view will receive <code class='syntax js'><span class=\"variable\">touchCancelled</span></code>.</li>\n</ul>\n\n<h2>What Does It Look Like?</h2>\n\n<p><a href='capturing.js' class='demo'>capturing.js</a></p>","errors":[],"demos":{"capturing.js":{"ex":"/**\n   This is our test view. It will capture a touch, and, after one second,\n   pass it through to the child view. Depending on the shouldStack property,\n   it will stack while passing.\n   \n   In this example, the top view stacks, the bottom one does not.\n*/\nvar Tester = SC.View.extend({\n  backgroundColor: \"white\",\n  \n  shouldStack: NO,\n  captureTouch: function() {\n    return YES;\n  },\n  \n  touchStart: function(touch) {\n    this._hasTouch = touch;\n    this.get(\"layer\").style.backgroundColor = \"red\";\n    \n    // in one second, we'll pass the touch along.\n    this.invokeLater(\"beginContentTouches\", 1000, touch);\n  },\n  \n  beginContentTouches: function(touch) {\n    // if our touch hasn't changed in the meantime\n    if (touch === this._hasTouch) {\n      // we'll pass the touch along.\n      touch.captureTouch(this, this.get(\"shouldStack\"));\n    }\n  },\n  \n  touchEnd: function(touch) {\n    this._hasTouch = NO;\n    this.get(\"layer\").style.backgroundColor = \"white\";\n  },\n  \n  touchCancelled: function(touch) {\n    this._hasTouch = NO;\n    this.get(\"layer\").style.backgroundColor = \"white\";\n  },\n  \n  childViews: \"inner\".w(),\n  inner: SC.View.design({\n    layout: { left: 50, top: 50, right: 50, bottom: 50 },\n    backgroundColor: \"gray\",\n    touchStart: function() {\n      this.get(\"layer\").style.backgroundColor = \"blue\";\n    },\n    \n    touchEnd: function() {\n      this.get(\"layer\").style.backgroundColor = \"gray\";\n    }\n    \n  })\n  \n});\n\nvar MyExampleView = SC.View.extend({\n  backgroundColor: \"#aaa\",\n  childViews: \"stacks doesNot\".w(),\n  stacks: Tester.extend({\n    layout: { top: 10, left: 10, width: 200, height: 200 },\n    shouldStack: YES\n  }),\n  \n  doesNot: Tester.extend({\n    layout: { top: 230, left: 10, width: 200, height: 200 },\n    shouldStack: NO    \n  })\n});\n\n// bootstrap code :)\nexports.getDemoView = function() {\n  return MyExampleView;\n};\n","highlighted":"<span class=\"multiline comment\">/**\n   This is our test view. It will capture a touch, and, after one second,\n   pass it through to the child view. Depending on the shouldStack property,\n   it will stack while passing.\n   \n   In this example, the top view stacks, the bottom one does not.\n*/</span>\n<span class=\"keyword\">var</span> <span class=\"class\">Tester</span> = <span class=\"class\">SC</span>.<span class=\"class\">View</span>.<span class=\"variable\">extend</span>({\n  <span class=\"variable\">backgroundColor</span>: <span class=\"string\">&quot;white&quot;</span>,\n  \n  <span class=\"variable\">shouldStack</span>: <span class=\"class\">NO</span>,\n  <span class=\"variable\">captureTouch</span>: <span class=\"keyword\">function</span>() {\n    <span class=\"keyword\">return</span> <span class=\"class\">YES</span>;\n  },\n  \n  <span class=\"variable\">touchStart</span>: <span class=\"keyword\">function</span>(<span class=\"variable\">touch</span>) {\n    <span class=\"this\">this</span>.<span class=\"variable\">_hasTouch</span> = <span class=\"variable\">touch</span>;\n    <span class=\"this\">this</span>.<span class=\"variable\">get</span>(<span class=\"string\">&quot;layer&quot;</span>).<span class=\"variable\">style</span>.<span class=\"variable\">backgroundColor</span> = <span class=\"string\">&quot;red&quot;</span>;\n    \n    <span class=\"comment\">// in one second, we'll pass the touch along.</span>\n    <span class=\"this\">this</span>.<span class=\"variable\">invokeLater</span>(<span class=\"string\">&quot;beginContentTouches&quot;</span>, <span class=\"number integer\">1000</span>, <span class=\"variable\">touch</span>);\n  },\n  \n  <span class=\"variable\">beginContentTouches</span>: <span class=\"keyword\">function</span>(<span class=\"variable\">touch</span>) {\n    <span class=\"comment\">// if our touch hasn't changed in the meantime</span>\n    <span class=\"keyword\">if</span> (<span class=\"variable\">touch</span> === <span class=\"this\">this</span>.<span class=\"variable\">_hasTouch</span>) {\n      <span class=\"comment\">// we'll pass the touch along.</span>\n      <span class=\"variable\">touch</span>.<span class=\"variable\">captureTouch</span>(<span class=\"this\">this</span>, <span class=\"this\">this</span>.<span class=\"variable\">get</span>(<span class=\"string\">&quot;shouldStack&quot;</span>));\n    }\n  },\n  \n  <span class=\"variable\">touchEnd</span>: <span class=\"keyword\">function</span>(<span class=\"variable\">touch</span>) {\n    <span class=\"this\">this</span>.<span class=\"variable\">_hasTouch</span> = <span class=\"class\">NO</span>;\n    <span class=\"this\">this</span>.<span class=\"variable\">get</span>(<span class=\"string\">&quot;layer&quot;</span>).<span class=\"variable\">style</span>.<span class=\"variable\">backgroundColor</span> = <span class=\"string\">&quot;white&quot;</span>;\n  },\n  \n  <span class=\"variable\">touchCancelled</span>: <span class=\"keyword\">function</span>(<span class=\"variable\">touch</span>) {\n    <span class=\"this\">this</span>.<span class=\"variable\">_hasTouch</span> = <span class=\"class\">NO</span>;\n    <span class=\"this\">this</span>.<span class=\"variable\">get</span>(<span class=\"string\">&quot;layer&quot;</span>).<span class=\"variable\">style</span>.<span class=\"variable\">backgroundColor</span> = <span class=\"string\">&quot;white&quot;</span>;\n  },\n  \n  <span class=\"variable\">childViews</span>: <span class=\"string\">&quot;inner&quot;</span>.<span class=\"variable\">w</span>(),\n  <span class=\"variable\">inner</span>: <span class=\"class\">SC</span>.<span class=\"class\">View</span>.<span class=\"variable\">design</span>({\n    <span class=\"variable\">layout</span>: { <span class=\"variable\">left</span>: <span class=\"number integer\">50</span>, <span class=\"variable\">top</span>: <span class=\"number integer\">50</span>, <span class=\"variable\">right</span>: <span class=\"number integer\">50</span>, <span class=\"variable\">bottom</span>: <span class=\"number integer\">50</span> },\n    <span class=\"variable\">backgroundColor</span>: <span class=\"string\">&quot;gray&quot;</span>,\n    <span class=\"variable\">touchStart</span>: <span class=\"keyword\">function</span>() {\n      <span class=\"this\">this</span>.<span class=\"variable\">get</span>(<span class=\"string\">&quot;layer&quot;</span>).<span class=\"variable\">style</span>.<span class=\"variable\">backgroundColor</span> = <span class=\"string\">&quot;blue&quot;</span>;\n    },\n    \n    <span class=\"variable\">touchEnd</span>: <span class=\"keyword\">function</span>() {\n      <span class=\"this\">this</span>.<span class=\"variable\">get</span>(<span class=\"string\">&quot;layer&quot;</span>).<span class=\"variable\">style</span>.<span class=\"variable\">backgroundColor</span> = <span class=\"string\">&quot;gray&quot;</span>;\n    }\n    \n  })\n  \n});\n\n<span class=\"keyword\">var</span> <span class=\"class\">MyExampleView</span> = <span class=\"class\">SC</span>.<span class=\"class\">View</span>.<span class=\"variable\">extend</span>({\n  <span class=\"variable\">backgroundColor</span>: <span class=\"string\">&quot;#aaa&quot;</span>,\n  <span class=\"variable\">childViews</span>: <span class=\"string\">&quot;stacks doesNot&quot;</span>.<span class=\"variable\">w</span>(),\n  <span class=\"variable\">stacks</span>: <span class=\"class\">Tester</span>.<span class=\"variable\">extend</span>({\n    <span class=\"variable\">layout</span>: { <span class=\"variable\">top</span>: <span class=\"number integer\">10</span>, <span class=\"variable\">left</span>: <span class=\"number integer\">10</span>, <span class=\"variable\">width</span>: <span class=\"number integer\">200</span>, <span class=\"variable\">height</span>: <span class=\"number integer\">200</span> },\n    <span class=\"variable\">shouldStack</span>: <span class=\"class\">YES</span>\n  }),\n  \n  <span class=\"variable\">doesNot</span>: <span class=\"class\">Tester</span>.<span class=\"variable\">extend</span>({\n    <span class=\"variable\">layout</span>: { <span class=\"variable\">top</span>: <span class=\"number integer\">230</span>, <span class=\"variable\">left</span>: <span class=\"number integer\">10</span>, <span class=\"variable\">width</span>: <span class=\"number integer\">200</span>, <span class=\"variable\">height</span>: <span class=\"number integer\">200</span> },\n    <span class=\"variable\">shouldStack</span>: <span class=\"class\">NO</span>    \n  })\n});\n\n<span class=\"comment\">// bootstrap code :)</span>\n<span class=\"variable\">exports</span>.<span class=\"variable\">getDemoView</span> = <span class=\"keyword\">function</span>() {\n  <span class=\"keyword\">return</span> <span class=\"class\">MyExampleView</span>;\n};\n","original":"/**\n   This is our test view. It will capture a touch, and, after one second,\n   pass it through to the child view. Depending on the shouldStack property,\n   it will stack while passing.\n   \n   In this example, the top view stacks, the bottom one does not.\n*/\nvar Tester = SC.View.extend({\n  backgroundColor: \"white\",\n  \n  shouldStack: NO,\n  captureTouch: function() {\n    return YES;\n  },\n  \n  touchStart: function(touch) {\n    this._hasTouch = touch;\n    this.get(\"layer\").style.backgroundColor = \"red\";\n    \n    // in one second, we'll pass the touch along.\n    this.invokeLater(\"beginContentTouches\", 1000, touch);\n  },\n  \n  beginContentTouches: function(touch) {\n    // if our touch hasn't changed in the meantime\n    if (touch === this._hasTouch) {\n      // we'll pass the touch along.\n      touch.captureTouch(this, this.get(\"shouldStack\"));\n    }\n  },\n  \n  touchEnd: function(touch) {\n    this._hasTouch = NO;\n    this.get(\"layer\").style.backgroundColor = \"white\";\n  },\n  \n  touchCancelled: function(touch) {\n    this._hasTouch = NO;\n    this.get(\"layer\").style.backgroundColor = \"white\";\n  },\n  \n  childViews: \"inner\".w(),\n  inner: SC.View.design({\n    layout: { left: 50, top: 50, right: 50, bottom: 50 },\n    backgroundColor: \"gray\",\n    touchStart: function() {\n      this.get(\"layer\").style.backgroundColor = \"blue\";\n    },\n    \n    touchEnd: function() {\n      this.get(\"layer\").style.backgroundColor = \"gray\";\n    }\n    \n  })\n  \n});\n\nvar MyExampleView = SC.View.extend({\n  backgroundColor: \"#aaa\",\n  childViews: \"stacks doesNot\".w(),\n  stacks: Tester.extend({\n    layout: { top: 10, left: 10, width: 200, height: 200 },\n    shouldStack: YES\n  }),\n  \n  doesNot: Tester.extend({\n    layout: { top: 230, left: 10, width: 200, height: 200 },\n    shouldStack: NO    \n  })\n});\n\n// bootstrap code :)\nexports.getDemoView = function() {\n  return MyExampleView;\n};\n"}},"articleDirectory":"articles/touch/","outputDirectory":"build/","title":"Capturing"}